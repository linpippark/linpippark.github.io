<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>113å­¸å¹´-åº·è»’(äº”ä¸Š)åœ‹èªç·šä¸ŠæœŸæœ«æ¸¬é©—ç³»çµ±</title>
    <style>
        :root {
            --primary: #2c3e50;
            --secondary: #e67e22; /* æ´»åŠ›æ©˜ */
            --accent: #e74c3c; /* è­¦ç¤ºç´… */
            --bg: #f3f5f7;
            --card-bg: #ffffff;
            --text: #2c3e50;
            --success: #27ae60;
        }

        body {
            font-family: "Microsoft JhengHei", "Heiti TC", sans-serif;
            background-color: var(--bg);
            color: var(--text);
            margin: 0;
            padding: 0;
            padding-bottom: 140px; /* é ç•™åº•éƒ¨ç©ºé–“çµ¦å›ºå®šæŒ‰éˆ•èˆ‡å‡ºè™• */
        }

        /* é ‚éƒ¨æ¨™é¡Œèˆ‡è¨ˆæ™‚å™¨ */
        header {
            background: linear-gradient(135deg, #3498db, #8e44ad);
            color: white;
            padding: 15px 20px;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        h1 { margin: 0; font-size: 1.4rem; }
        
        #timer-display {
            background: rgba(0,0,0,0.3);
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 1.5rem;
            font-weight: bold;
            font-family: monospace;
            min-width: 100px;
            text-align: center;
        }

        .container {
            max-width: 900px;
            margin: 20px auto;
            padding: 0 15px;
        }

        /* é–‹å§‹ç•«é¢ */
        #start-screen {
            background: var(--card-bg);
            border-radius: 15px;
            padding: 40px;
            text-align: center;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            margin-top: 50px;
        }

        .random-switch {
            margin: 20px 0;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            cursor: pointer;
        }
        
        .random-switch input {
            width: 20px;
            height: 20px;
        }

        .btn-start {
            background: var(--secondary);
            color: white;
            font-size: 1.5rem;
            padding: 15px 50px;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            transition: transform 0.2s;
            box-shadow: 0 4px 0 #d35400;
        }
        .btn-start:active { transform: translateY(4px); box-shadow: none; }

        /* é¡Œç›®å¡ç‰‡ */
        .question-card {
            background: var(--card-bg);
            margin-bottom: 20px;
            padding: 25px;
            border-radius: 12px;
            border-left: 6px solid #3498db;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            position: relative;
        }

        .q-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
        }

        .q-text {
            font-size: 1.2rem;
            font-weight: bold;
            width: 85%;
            line-height: 1.5;
        }

        /* ç¨å¾Œä½œç­” */
        .review-label {
            font-size: 0.9rem;
            color: #7f8c8d;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
            background: #ecf0f1;
            padding: 5px 10px;
            border-radius: 15px;
        }
        .review-label input { cursor: pointer; }
        
        .marked-review {
            border-left-color: var(--secondary) !important;
            background-color: #fffaf0;
        }

        /* é¸é …æ¨£å¼ */
        .options-container label {
            display: block;
            margin: 10px 0;
            padding: 12px 15px;
            background: #f8f9fa;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            border: 1px solid transparent;
        }

        .options-container label:hover {
            background: #eaf2f8;
            border-color: #3498db;
        }

        .options-container input { margin-right: 12px; transform: scale(1.2); }

        /* é–±è®€æ¸¬é©—å€å¡Š */
        .reading-passage {
            background: #e8f6f3;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            line-height: 1.8;
            border: 2px dashed #1abc9c;
            color: #16a085;
        }

        /* åº•éƒ¨å›ºå®šçµ±è¨ˆèˆ‡æŒ‰éˆ• */
        footer {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background: rgba(255, 255, 255, 0.95);
            box-shadow: 0 -4px 15px rgba(0,0,0,0.1);
            padding: 10px 0;
            z-index: 900;
            display: flex;
            flex-direction: column;
            align-items: center;
            backdrop-filter: blur(5px);
        }

        .stats-bar {
            display: flex;
            gap: 20px;
            margin-bottom: 10px;
            font-size: 1rem;
        }

        .stat-item b { font-size: 1.2rem; margin-left: 5px; }
        .stat-ans { color: var(--success); }
        .stat-unans { color: var(--accent); }
        .stat-mark { color: var(--secondary); }

        .btn-submit {
            background: var(--accent);
            color: white;
            border: none;
            padding: 10px 60px;
            border-radius: 30px;
            font-size: 1.3rem;
            cursor: pointer;
            font-weight: bold;
            box-shadow: 0 4px 10px rgba(231, 76, 60, 0.4);
        }
        .btn-submit:hover { background: #c0392b; }

        /* è€ƒé¡Œä¾†æºå‡ºè™•æ¨£å¼ (æ–°å¢) */
        .source-footer {
            text-align: center;
            color: #95a5a6;
            font-size: 0.85rem;
            margin-top: 30px;
            padding: 20px 0;
            border-top: 1px solid #e0e0e0;
        }

        /* çµæœå±•ç¤º */
        .wrong-ans-card {
            background-color: #ffecec !important;
            border-left-color: var(--accent) !important;
        }
        
        .feedback-text {
            margin-top: 15px;
            padding: 10px;
            background: rgba(231, 76, 60, 0.1);
            color: #c0392b;
            border-radius: 5px;
            font-weight: bold;
        }

        .correct-ref { margin-left: 10px; color: #c0392b; }
        
        #result-header {
            text-align: center;
            padding: 20px;
            background: white;
            margin-bottom: 20px;
            border-radius: 10px;
        }
        
        .score-big {
            font-size: 3rem;
            color: var(--secondary);
            font-weight: bold;
        }

        .hidden { display: none !important; }
        
        .btn-admin {
            margin-top: 20px;
            background: #95a5a6;
            color: white;
            border: none;
            padding: 5px 15px;
            border-radius: 4px;
            cursor: pointer;
        }
    </style>
</head>
<body>

<header>
    <h1>113å­¸å¹´-åº·è»’(äº”ä¸Š)åœ‹èªç·šä¸ŠæœŸæœ«æ¸¬é©—ç³»çµ±</h1>
    <div id="timer-display">40:00</div>
</header>

<div class="container" id="main-container">
    
    <div id="start-screen">
        <h2>ğŸ‘‹ å„ä½å®¶é•·èˆ‡åŒå­¸å¥½ï¼</h2>
        <p>ç¯„åœï¼šåº·è»’äº”ä¸Š ç•«å®¶çš„å¤©ç©ºã€L7-L12ã€é–±è®€éšæ¢¯äºŒ</p>
        <p>é¡Œæ•¸ï¼š50é¡Œ (æ¯é¡Œ2åˆ†) | æ™‚é–“ï¼š40åˆ†é˜</p>
        
        <label class="random-switch">
            <input type="checkbox" id="randomize-toggle" checked>
            <span>ğŸ² é–‹å•Ÿéš¨æ©Ÿå‡ºé¡Œæ¨¡å¼ (é¡Œç›®é †åºæ‰“äº‚)</span>
        </label>
        
        <button class="btn-start" onclick="startQuiz()">é–‹å§‹ä½œç­”</button>
        <br>
        <button class="btn-admin" onclick="checkAnswersAdmin()">ğŸ”‘ é¡¯ç¤ºç­”æ¡ˆ (å¯†ç¢¼ä¿è­·)</button>
    </div>

    <div id="quiz-area" class="hidden">
        </div>

    <div id="result-area" class="hidden">
        <div id="result-header">
            <h3>æ¸¬é©—çµæœ</h3>
            <div class="score-big" id="final-score">0 åˆ†</div>
            <p>éŒ¯é¡Œå·²ç”¨ç´…è‰²æ¨™ç¤ºï¼Œè«‹å¾€ä¸‹æŸ¥çœ‹è©³ç´°æª¢è¨ã€‚</p>
            <button class="btn-start" style="font-size:1rem; padding:10px 20px;" onclick="downloadExcel()">ğŸ“¥ ä¸‹è¼‰éŒ¯é¡Œå ±å‘Š (exam_result.xls)</button>
        </div>
        </div>

    <div class="source-footer">
        è€ƒé¡Œä¾†æºï¼šæ•™è‚²éƒ¨å¯©å®šåº·è»’ç‰ˆåœ‹å°äº”å¹´ç´šä¸Šå­¸æœŸåœ‹èªæ•™æ ï¼ æ­·å¹´è‡ºç£åœ°å€åœ‹å°æœŸæœ«è€ƒå¤é¡Œè³‡æ–™åº«å½™æ•´<br>
    </div>
</div>

<footer id="footer-controls" class="hidden">
    <div class="stats-bar">
        <span class="stat-item stat-ans">å·²ç­”ï¼š<b id="count-ans">0</b></span>
        <span class="stat-item stat-unans">æœªç­”ï¼š<b id="count-unans">50</b></span>
        <span class="stat-item stat-mark">ç¨å¾Œä½œç­”ï¼š<b id="count-mark">0</b></span>
    </div>
    <button class="btn-submit" onclick="preSubmitCheck()">ç¹³å·é€å‡º</button>
</footer>

<script>
    // é¡Œåº«è³‡æ–™ (50é¡Œ)
    const questionPool = [
        // æ˜¯éé¡Œ (15é¡Œ)
        {id: 1, type: 'tf', q: 'ã€ç¬¬ä¸ƒèª²ã€‘åœ¨ã€Œç‚ºç”Ÿå‘½æ‰¾å‡ºå£ã€ä¸€æ–‡ä¸­ï¼Œä½œè€…ä»¥ä»™äººæŒç‚ºä¾‹ï¼Œèªªæ˜ç”Ÿç‰©ç‚ºäº†é©æ‡‰æ²™æ¼ ç¼ºæ°´çš„ç’°å¢ƒï¼Œå°‡è‘‰å­æ¼”åŒ–æˆé‡ç‹€ã€‚', a: 'O'},
        {id: 2, type: 'tf', q: 'ã€ç¬¬å…«èª²ã€‘é¦¬æ‹‰æ‹‰ä¾†è‡ªç¾åœ‹ï¼Œå¥¹æ˜¯ç‚ºäº†çˆ­å–å…’ç«¥åŠå¹´è¼•äººå—æ•™è‚²çš„æ¬Šåˆ©è€Œå—å‚·çš„ã€‚', a: 'X', note: 'é¦¬æ‹‰æ‹‰ä¾†è‡ªå·´åŸºæ–¯å¦ã€‚'},
        {id: 3, type: 'tf', q: 'ã€ç¬¬åèª²ã€‘ã€Œå±±ä¸­å¯„æƒ…ã€ä¸€æ–‡ä¸­ï¼Œä½œè€…èªç‚ºå±±æ—ä¸è«–æ˜¯æ™´å¤©æˆ–é›¨å¤©ï¼Œéƒ½æœ‰å®ƒç¨ç‰¹çš„ç¾æ„Ÿã€‚', a: 'O'},
        {id: 4, type: 'tf', q: 'ã€ç¬¬åäºŒèª²ã€‘ã€Œè’å³¶ä¸Šçš„åœ‹ç‹ã€æ˜¯æ”¹ç·¨è‡ªå°èªªã€Šé­¯æ¿±éœæ¼‚æµè¨˜ã€‹ï¼Œä¸»è§’æœ€å¾Œé¸æ“‡ç•™åœ¨è’å³¶ä¸å›äººé¡ç¤¾æœƒã€‚', a: 'X', note: 'ä¸»è§’æœ€å¾Œç²æ•‘å›åˆ°äººé¡ç¤¾æœƒã€‚'},
        {id: 5, type: 'tf', q: 'ã€é–±è®€éšæ¢¯ä¸€ã€‘é½Šç™½çŸ³ç•«è¦å­è¬›æ±‚ã€Œç¥éŸ»ã€ï¼Œä»–èªç‚ºç•«ç•«è‹¥æ˜¯å¤ªåƒçœŸçš„å°±åƒåœ¨åªšä¿—ï¼Œå¤ªä¸åƒå‰‡æ˜¯æ¬ºä¸–ã€‚', a: 'O'},
        {id: 6, type: 'tf', q: 'ã€ç¬¬åä¸€èª²ã€‘å¸ƒè¾²æ—äººç¨±é»‘ç†Šç‚ºã€Œé”é§­ã€ï¼Œåœ¨å‚³èªªä¸­é»‘ç†Šæ˜¯æ‡¶æƒ°ä¸”æ„šç¬¨çš„å‹•ç‰©ã€‚', a: 'X', note: 'é»‘ç†Šåœ¨å‚³èªªä¸­æ˜¯æœ‰åŠ›é‡ä¸”å—å°Šæ•¬çš„ã€‚'},
        {id: 7, type: 'tf', q: 'ã€ç¬¬ä¹èª²ã€‘ã€Œåœ¨æŒ«æŠ˜ä¸­æˆé•·ã€å‘Šè¨´æˆ‘å€‘ï¼Œæå®‰å°æ¼”æ›¾ç¶“å¤±æ¥­å…­å¹´ï¼Œä½†ä»–æ²’æœ‰æ”¾æ£„é›»å½±å¤¢ï¼Œé€™å°±æ˜¯è¶ŠæŒ«è¶Šå‹‡çš„è¡¨ç¾ã€‚', a: 'O'},
        {id: 8, type: 'tf', q: 'ã€å­—éŸ³ã€‘ã€Œå¼·ã€äººæ‰€é›£çš„ã€Œå¼·ã€è®€éŸ³æ˜¯ã€Œã„‘ã„§ã„¤ËŠã€ã€‚', a: 'X', note: 'æ‡‰è®€ä½œã€Œã„‘ã„§ã„¤Ë‡ã€ã€‚'},
        {id: 9, type: 'tf', q: 'ã€ä¿®è¾­ã€‘ã€Œé¢¨å…’è¼•è¼•çš„å”±è‘—æ­Œã€é€™å¥è©±ä½¿ç”¨äº†ã€Œè­¬å–»ã€ä¿®è¾­ã€‚', a: 'X', note: 'é€™æ˜¯ã€Œè½‰åŒ–(æ“¬äºº)ã€ä¿®è¾­ã€‚'},
        {id: 10, type: 'tf', q: 'ã€é–±è®€éšæ¢¯äºŒã€‘ã€Œåˆ†äº«çš„é‡‘ç‰Œã€æ•…äº‹ä¸­ï¼Œç‰¹å¥§æœƒçš„é¸æ‰‹å€‘ç‚ºäº†é‡‘ç‰Œäº’ç›¸æ¨æ“ ï¼Œç«¶çˆ­éå¸¸æ¿€çƒˆã€‚', a: 'X', note: 'ä»–å€‘å±•ç¾äº†äº’åŠ©åˆä½œçš„ç²¾ç¥ã€‚'},
        {id: 11, type: 'tf', q: 'ã€ç¬¬åäºŒèª²ã€‘é­¯æ¿±éœåœ¨å³¶ä¸Šæ•‘ä¸‹çš„é‡äººï¼Œå› ç‚ºæ˜¯åœ¨æ˜ŸæœŸäº”æ•‘çš„ï¼Œæ‰€ä»¥å–åç‚ºã€Œæ˜ŸæœŸäº”ã€ã€‚', a: 'O'},
        {id: 12, type: 'tf', q: 'ã€ç¬¬ä¸ƒèª²ã€‘æ–·äº†è…¿çš„èœ˜è››å¦‚æœä¸æ”¾æ£„ï¼Œä¾ç„¶å¯ä»¥çµå‡ºå®Œæ•´çš„ç¶²ï¼Œé€™æ˜¯ç”Ÿå‘½åŠ›çš„å±•ç¾ã€‚', a: 'O'},
        {id: 13, type: 'tf', q: 'ã€å­—å½¢ã€‘ã€Œæç„¶å¤§æ‚Ÿã€çš„ã€Œæã€æ˜¯å¿ƒéƒ¨ï¼Œæ„æ€æ˜¯å¿½ç„¶æ˜ç™½ã€‚', a: 'O'},
        {id: 14, type: 'tf', q: 'ã€ç¬¬åèª²ã€‘ä½œè€…åœ¨å±±æ—ä¸­æ„Ÿåˆ°ææ‡¼ï¼Œå› ç‚ºæ¨¹æœ¨é•·å¾—å¤ªé«˜å¤§é®ä½äº†é™½å…‰ã€‚', a: 'X', note: 'ä½œè€…æ„Ÿåˆ°å¯§éœèˆ‡æ”¾é¬†ã€‚'},
        {id: 15, type: 'tf', q: 'ã€ç¬¬åä¸€èª²ã€‘ä½œè€…èªç‚ºäººé¡æ‡‰è©²è¦å¾æœå±±æ—ï¼Œè­‰æ˜äººé¡æ¯”é‡ç”Ÿå‹•ç‰©å„ªè¶Šã€‚', a: 'X', note: 'æ‡‰æ˜¯äº’ç›¸å°Šé‡ï¼Œå’Œå¹³å…±å­˜ã€‚'},

        // é¸æ“‡é¡Œ (30é¡Œ)
        {id: 16, type: 'mc', q: 'ã€ç¬¬å…«èª²ã€‘é—œæ–¼é¦¬æ‹‰æ‹‰çš„æ•˜è¿°ï¼Œä¸‹åˆ—ä½•è€…æ­£ç¢ºï¼Ÿ', opts: ['å¥¹æ˜¯è«¾è²çˆ¾ç‰©ç†çå¾—ä¸»', 'å¥¹ç‚ºäº†çˆ­å–æŠ•ç¥¨æ¬Šè€Œå—å‚·', 'å¥¹æ˜¯å²ä¸Šæœ€å¹´è¼•çš„è«¾è²çˆ¾å’Œå¹³çå¾—ä¸»', 'å¥¹ç™¼æ˜äº†æ–°çš„æ•™å­¸æ³•'], a: 'å¥¹æ˜¯å²ä¸Šæœ€å¹´è¼•çš„è«¾è²çˆ¾å’Œå¹³çå¾—ä¸»'},
        {id: 17, type: 'mc', q: 'ã€ç¬¬ä¹èª²ã€‘é¢å°æŒ«æŠ˜æ™‚ï¼Œä½œè€…å»ºè­°æˆ‘å€‘æ‡‰æŠ±æŒä½•ç¨®æ…‹åº¦ï¼Ÿ', opts: ['æ€¨å¤©å°¤äºº', 'é€ƒé¿ç¾å¯¦', 'æ­£å‘æ€è€ƒï¼Œå¾ä¸­å­¸ç¿’', 'ä¾è³´çˆ¶æ¯è§£æ±º'], a: 'æ­£å‘æ€è€ƒï¼Œå¾ä¸­å­¸ç¿’'},
        {id: 18, type: 'mc', q: 'ã€å­—éŸ³ã€‘ä¸‹åˆ—ã€Œã€ä¸­çš„å­—éŸ³ä½•è€…æ­£ç¢ºï¼Ÿ', opts: ['ã€Œä¾›ã€æ‡‰ï¼šã„ã„¨ã„¥', 'ã€Œè™•ã€ç½°ï¼šã„”ã„¨Ë‹', 'ã€Œå‰µã€å‚·ï¼šã„”ã„¨ã„¤Ë‹', 'å‹‰å¼·ï¼šã„‡ã„§ã„¢Ë‡ ã„‘ã„§ã„¤ËŠ'], a: 'ã€Œå‰µã€å‚·ï¼šã„”ã„¨ã„¤Ë‹'}, // ä¾›gong1, è™•chu3, å¼·qiang3
        {id: 19, type: 'mc', q: 'ã€æˆèªã€‘å½¢å®¹ä¸€å€‹äººé›–ç„¶å¤±æ•—äº†ï¼Œä½†æ„å¿—æ›´åŠ å …å®šã€‚', opts: ['åŠé€”è€Œå»¢', 'è¶ŠæŒ«è¶Šå‹‡', 'å¾—æ„å¿˜å½¢', 'è‡ªæš´è‡ªæ£„'], a: 'è¶ŠæŒ«è¶Šå‹‡'},
        {id: 20, type: 'mc', q: 'ã€ç¬¬åäºŒèª²ã€‘é­¯æ¿±éœåœ¨è’å³¶ä¸Šåº¦éäº†å¹¾å¹´ï¼Ÿ', opts: ['ç´„10å¹´', 'ç´„28å¹´', 'ç´„50å¹´', 'ç´„3å€‹æœˆ'], a: 'ç´„28å¹´'},
        {id: 21, type: 'mc', q: 'ã€ç¬¬ä¸ƒèª²ã€‘ä¸‹åˆ—å“ªä¸€å€‹ä¾‹å­ã€Œä¸æ˜¯ã€æ–‡ä¸­æåˆ°ç”Ÿå‘½å°‹æ‰¾å‡ºè·¯çš„è¡¨ç¾ï¼Ÿ', opts: ['å²©ç¸«ä¸­çš„å°è‰', 'æº«å®¤è£¡çš„è˜­èŠ±', 'æ²™æ¼ ä¸­çš„ä»™äººæŒ', 'æ–·è…¿çš„èœ˜è››'], a: 'æº«å®¤è£¡çš„è˜­èŠ±'},
        {id: 22, type: 'mc', q: 'ã€ä¿®è¾­ã€‘ã€Œé‚£é›™çœ¼ç›åƒæ˜Ÿæ˜Ÿä¸€æ¨£é–ƒäº®ã€‚ã€ä½¿ç”¨äº†å“ªç¨®ä¿®è¾­ï¼Ÿ', opts: ['æ’æ¯”', 'è­¬å–»', 'æ“¬äºº', 'è¨­å•'], a: 'è­¬å–»'},
        {id: 23, type: 'mc', q: 'ã€å­—å½¢ã€‘ä¸‹åˆ—å“ªå€‹è©èªç”¨å­—å®Œå…¨æ­£ç¢ºï¼Ÿ', opts: ['åè½å­«å±±', 'åè½æ·±å±±', 'æ˜è½å­«å±±', 'åæ´›å­«å±±'], a: 'åè½å­«å±±'},
        {id: 24, type: 'mc', q: 'ã€é–±è®€éšæ¢¯ä¸€ã€‘é½Šç™½çŸ³åŸæœ¬å¾äº‹ä»€éº¼è¡Œæ¥­ï¼Ÿ', opts: ['éµåŒ ', 'æœ¨åŒ ', 'å»šå¸«', 'è£ç¸«å¸«'], a: 'æœ¨åŒ '},
        {id: 25, type: 'mc', q: 'ã€ç¬¬åä¸€èª²ã€‘ã€Œèˆ‡é”é§­é»‘ç†Šèµ°å…¥å±±æ—ã€ä¸­ï¼Œä½œè€…å°é»‘ç†Šçš„æƒ…æ„Ÿæ˜¯ï¼Ÿ', opts: ['æ†æ¨', 'ææ‡¼', 'æ•¬é‡', 'è¼•è¦–'], a: 'æ•¬é‡'},
        {id: 26, type: 'mc', q: 'ã€Œéœè¬ã€çš„æ„æ€æ˜¯ï¼Ÿ', opts: ['éå¸¸åµé¬§', 'å®‰éœ', 'ç¥•å¯†', 'å‹•ä½œå¿«é€Ÿ'], a: 'å®‰éœ'},
        {id: 27, type: 'mc', q: 'ã€å¥å‹ã€‘ã€Œèˆ‡å…¶......ä¸å¦‚......ã€é€™å¥å‹è¡¨ç¤ºï¼Ÿ', opts: ['å› æœé—œä¿‚', 'é¸æ“‡é—œä¿‚', 'æ¢ä»¶é—œä¿‚', 'è½‰æŠ˜é—œä¿‚'], a: 'é¸æ“‡é—œä¿‚'},
        {id: 28, type: 'mc', q: 'ã€ç¬¬åèª²ã€‘ä½œè€…åœ¨å±±ä¸­è½åˆ°äº†ä»€éº¼è²éŸ³è®“ä»–è¦ºå¾—æ‚…è€³ï¼Ÿ', opts: ['è»Šæ°´é¦¬é¾è²', 'èŸ²é³´é³¥å«è²', 'å·¥å» æ©Ÿå™¨è²', 'é›·è²'], a: 'èŸ²é³´é³¥å«è²'},
        {id: 29, type: 'mc', q: 'ã€å­—ç¾©ã€‘è’å³¶çš„ã€Œè’ã€æ„æ€æ˜¯ï¼Ÿ', opts: ['æ…Œå¼µ', 'è’å”', 'ååƒ»ã€ç„¡äººé–‹å¢¾', 'é£¢è’'], a: 'ååƒ»ã€ç„¡äººé–‹å¢¾'},
        {id: 30, type: 'mc', q: 'ä¸‹åˆ—å“ªä¸€å€‹å­—çš„éƒ¨é¦–éŒ¯èª¤ï¼Ÿ', opts: ['ã€Œå¯„ã€ï¼šå®€éƒ¨', 'ã€Œå‹‡ã€ï¼šåŠ›éƒ¨', 'ã€Œå³¶ã€ï¼šé³¥éƒ¨', 'ã€ŒæŒ«ã€ï¼šæ‰‹éƒ¨'], a: 'ã€Œå³¶ã€ï¼šé³¥éƒ¨'}, // å³¶æ˜¯å±±éƒ¨
        {id: 31, type: 'mc', q: 'ã€Œè‚†è™ã€çš„æ„æ€æ˜¯ï¼Ÿ', opts: ['ä»»æ„ä½œæƒ¡', 'å¹«åŠ©åˆ¥äºº', 'å››è™•éŠç©', 'å¤©æ°£æ™´æœ—'], a: 'ä»»æ„ä½œæƒ¡'},
        {id: 32, type: 'mc', q: 'ã€ç¬¬ä¹èª²ã€‘ä¸‹åˆ—å“ªå€‹äººç‰©æ˜¯èª²æ–‡ä¸­æåˆ°ã€Œé¢å°æŒ«æŠ˜ã€çš„ä¾‹å­ï¼Ÿ', opts: ['æ„›è¿ªç”Ÿ', 'æå®‰', 'è²å¤šèŠ¬', 'æ—æ›¸è±ª'], a: 'æå®‰'},
        {id: 33, type: 'mc', q: 'ã€ç¬¬åäºŒèª²ã€‘é­¯æ¿±éœåœ¨å³¶ä¸Šç‚ºäº†ç”Ÿå­˜ï¼Œåšäº†å“ªä»¶äº‹ï¼Ÿ', opts: ['é–‹ä¾¿åˆ©å•†åº—', 'ç¨®æ¤å¤§éº¥å’Œç¨»å­', 'æ‰“é›»è©±æ±‚æ•‘', 'èˆ‡é‡äººé–‹æˆ°'], a: 'ç¨®æ¤å¤§éº¥å’Œç¨»å­'},
        {id: 34, type: 'mc', q: 'ä¸‹åˆ—è©èªä½•è€…å¯ä»¥ç”¨ä¾†å½¢å®¹ã€Œé½Šç™½çŸ³ã€çš„ç•«é¢¨ï¼Ÿ', opts: ['é‡‘ç¢§è¼ç…Œ', 'æ¨¸å¯¦è‡ªç„¶', 'æŠ½è±¡é›£æ‡‚', 'è¯éº—è¤‡é›œ'], a: 'æ¨¸å¯¦è‡ªç„¶'},
        {id: 35, type: 'mc', q: 'ã€Œæªæ‰‹ä¸åŠã€çš„æ„æ€æ˜¯ï¼Ÿ', opts: ['äº‹æƒ…ç™¼ç”Ÿå¤ªå¿«ï¼Œä¾†ä¸åŠæ‡‰ä»˜', 'æ‰‹å—å‚·äº†', 'å½¢å®¹éå¸¸é«˜èˆˆ', 'å½¢å®¹å¾ˆæœ‰è¨ˆç•«'], a: 'äº‹æƒ…ç™¼ç”Ÿå¤ªå¿«ï¼Œä¾†ä¸åŠæ‡‰ä»˜'},
        {id: 36, type: 'mc', q: 'ã€ç¬¬å…«èª²ã€‘é¦¬æ‹‰æ‹‰åˆ©ç”¨ä»€éº¼æ–¹å¼è®“ä¸–ç•Œè½è¦‹å¥¹çš„è²éŸ³ï¼Ÿ', opts: ['æ‹é›»å½±', 'å¯«éƒ¨è½æ ¼(æ—¥è¨˜)', 'ç•«æ¼«ç•«', 'å”±æ­Œ'], a: 'å¯«éƒ¨è½æ ¼(æ—¥è¨˜)'},
        {id: 37, type: 'mc', q: 'ã€ç¬¬åä¸€èª²ã€‘æ–‡ä¸­æåˆ°äººé¡æ‡‰å¦‚ä½•èˆ‡å±±æ—ç›¸è™•ï¼Ÿ', opts: ['å¤§é‡ç ä¼', 'äº’ç›¸å°Šé‡ï¼Œå’Œå¹³å…±å­˜', 'æ•æ‰æ‰€æœ‰å‹•ç‰©', 'è“‹æ»¿åˆ¥å¢…'], a: 'äº’ç›¸å°Šé‡ï¼Œå’Œå¹³å…±å­˜'},
        {id: 38, type: 'mc', q: 'ä¸‹åˆ—å“ªä¸€å¥è©±å«æœ‰ã€Œé¼“å‹µã€çš„èªæ°£ï¼Ÿ', opts: ['ä½ æ€éº¼é€™éº¼ç¬¨ï¼', 'é€™é»å°äº‹éƒ½åšä¸å¥½ã€‚', 'å¤±æ•—æ²’é—œä¿‚ï¼Œä¸‹æ¬¡å†åŠªåŠ›å°±å¥½ã€‚', 'æ”¾æ£„å§ã€‚'], a: 'å¤±æ•—æ²’é—œä¿‚ï¼Œä¸‹æ¬¡å†åŠªåŠ›å°±å¥½ã€‚'},
        {id: 39, type: 'mc', q: 'ã€Œå´å¶‡ã€é€šå¸¸ç”¨ä¾†å½¢å®¹ï¼Ÿ', opts: ['è·¯é¢å¹³å¦', 'å±±è·¯é«˜ä½ä¸å¹³', 'æ°´æµæ¹æ€¥', 'å¿ƒæƒ…å¹³éœ'], a: 'å±±è·¯é«˜ä½ä¸å¹³'},
        {id: 40, type: 'mc', q: 'ã€é–±è®€éšæ¢¯äºŒã€‘ç‰¹å¥§æœƒé¸æ‰‹è·Œå€’å¾Œï¼Œå…¶ä»–é¸æ‰‹æ€éº¼åšï¼Ÿ', opts: ['å˜²ç¬‘ä»–', 'ç¹¼çºŒå¾€å‰è·‘', 'åœä¸‹ä¾†æ‰¶èµ·ä»–ï¼Œä¸€èµ·èµ°', 'å‘è£åˆ¤æŠ—è­°'], a: 'åœä¸‹ä¾†æ‰¶èµ·ä»–ï¼Œä¸€èµ·èµ°'},
        {id: 41, type: 'mc', q: 'ã€å­—éŸ³ã€‘ã€Œå‰µã€ä½œçš„è®€éŸ³ï¼Ÿ', opts: ['ã„”ã„¨ã„¤', 'ã„”ã„¨ã„¤Ë‹', 'ã„˜ã„¤', 'ã„˜ã„¤Ë‹'], a: 'ã„”ã„¨ã„¤Ë‹'},
        {id: 42, type: 'mc', q: 'ã€ä¿®è¾­ã€‘ã€Œå¤±æ•—æ˜¯æˆåŠŸçš„å¢Šè…³çŸ³ã€‚ã€ä½¿ç”¨äº†ä»€éº¼ä¿®è¾­ï¼Ÿ', opts: ['èª‡é£¾', 'è­¬å–»', 'æ“¬äºº', 'é¡ç–Š'], a: 'è­¬å–»'},
        {id: 43, type: 'mc', q: 'ä¸‹åˆ—å“ªå€‹è©èªèˆ‡ã€Œå …æŒåˆ°åº•ã€æ„æ€ç›¸è¿‘ï¼Ÿ', opts: ['åŠé€”è€Œå»¢', 'é¥è€Œä¸æ¨', 'ä¸€æš´åå¯’', 'ä¸‰å¿ƒäºŒæ„'], a: 'é¥è€Œä¸æ¨'},
        {id: 44, type: 'mc', q: 'ã€ç¬¬åèª²ã€‘ã€Œå±±ä¸­å¯„æƒ…ã€é¡¯ç¤ºå‡ºä½œè€…å…·æœ‰ä»€éº¼æ¨£çš„æ€§æ ¼ï¼Ÿ', opts: ['å–œæ„›è‡ªç„¶', 'è²ªåœ–å¯Œè²´', 'è†½å°æ€•äº‹', 'å–œæ­¡ç†±é¬§'], a: 'å–œæ„›è‡ªç„¶'},
        {id: 45, type: 'mc', q: 'ã€ç¬¬åäºŒèª²ã€‘é­¯æ¿±éœå‰›åˆ°è’å³¶æ™‚çš„å¿ƒæƒ…æ˜¯å¦‚ä½•çš„ï¼Ÿ', opts: ['èˆˆå¥®', 'çµ•æœ›ææ‡¼', 'å¹³éœ', 'æ†¤æ€’'], a: 'çµ•æœ›ææ‡¼'},

        // é–±è®€æ¸¬é©— (5é¡Œ) - ä¸€å€‹é¡Œçµ„
        {
            id: 46, type: 'read', group: 'read1', 
            passage: 'ã€é–±è®€æ¸¬é©—ï¼šç¥å¥‡çš„è™è ã€‘\nè™è æ˜¯å”¯ä¸€æœƒé£›çš„å“ºä¹³é¡å‹•ç‰©ã€‚ç‰ å€‘é›–ç„¶è¦–åŠ›ä¸å¥½ï¼Œä½†è½åŠ›æ¥µä½³ã€‚è™è åœ¨é£›è¡Œæ™‚æœƒç™¼å‡ºè¶…éŸ³æ³¢ï¼Œç•¶è²æ³¢ç¢°åˆ°ç‰©é«”åå°„å›ä¾†ï¼Œç‰ å°±èƒ½åˆ¤æ–·å‰æ–¹éšœç¤™ç‰©çš„ä½ç½®èˆ‡å¤§å°ï¼Œé€™ç¨±ç‚ºã€Œå›è²å®šä½ã€ã€‚ç§‘å­¸å®¶æ¨¡ä»¿é€™å€‹åŸç†ï¼Œç™¼æ˜äº†é›·é”ï¼Œå»£æ³›æ‡‰ç”¨åœ¨é£›æ©Ÿå°èˆªèˆ‡æ°£è±¡è§€æ¸¬ä¸Šã€‚',
            q: 'è™è å±¬æ–¼å“ªä¸€é¡å‹•ç‰©ï¼Ÿ', opts: ['é³¥é¡', 'æ˜†èŸ²', 'å“ºä¹³é¡', 'çˆ¬èŸ²é¡'], a: 'å“ºä¹³é¡'
        },
        {id: 47, type: 'read', group: 'read1', q: 'è™è åˆ©ç”¨ä»€éº¼ä¾†åˆ¤æ–·éšœç¤™ç‰©çš„ä½ç½®ï¼Ÿ', opts: ['è¦–åŠ›', 'å—…è¦º', 'å›è²å®šä½', 'è§¸è¦º'], a: 'å›è²å®šä½'},
        {id: 48, type: 'read', group: 'read1', q: 'äººé¡æ¨¡ä»¿è™è çš„åŸç†ç™¼æ˜äº†ä»€éº¼ï¼Ÿ', opts: ['é£›æ©Ÿ', 'é›·é”', 'æ½›æ°´è‰‡', 'æœ›é é¡'], a: 'é›·é”'},
        {id: 49, type: 'read', group: 'read1', q: 'æ ¹æ“šæ–‡ç« ï¼Œè™è çš„å“ªç¨®æ„Ÿå®˜æœ€éˆæ•ï¼Ÿ', opts: ['è¦–è¦º', 'è½è¦º', 'å‘³è¦º', 'è§¸è¦º'], a: 'è½è¦º'},
        {id: 50, type: 'read', group: 'read1', q: 'æ–‡ç« ä¸­æåˆ°çš„ã€Œè¶…éŸ³æ³¢ã€åŠŸèƒ½æ˜¯ä»€éº¼ï¼Ÿ', opts: ['ç”¨ä¾†æ”»æ“Šæ•µäºº', 'ç”¨ä¾†å°èˆªèˆ‡æ¢æ¸¬', 'ç”¨ä¾†æ±‚å¶', 'ç”¨ä¾†ç…§æ˜'], a: 'ç”¨ä¾†å°èˆªèˆ‡æ¢æ¸¬'}
    ];

    let timer;
    let timeLeft = 40 * 60; // 40åˆ†é˜
    let currentQuestions = [];
    
    // æ´—ç‰Œå‡½æ•¸ (Fisher-Yates Shuffle)
    function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
        return array;
    }

    function startQuiz() {
        const isRandom = document.getElementById('randomize-toggle').checked;
        
        // æº–å‚™é¡Œç›®
        currentQuestions = [...questionPool];
        if (isRandom) {
            currentQuestions = shuffleArray(currentQuestions);
        }

        // UI åˆ‡æ›
        document.getElementById('start-screen').classList.add('hidden');
        document.getElementById('quiz-area').classList.remove('hidden');
        document.getElementById('footer-controls').classList.remove('hidden');
        
        // æ¸²æŸ“é¡Œç›®
        renderQuestions();
        
        // å•Ÿå‹•è¨ˆæ™‚
        timer = setInterval(updateTimer, 1000);
    }

    function renderQuestions() {
        const quizArea = document.getElementById('quiz-area');
        quizArea.innerHTML = '';

        currentQuestions.forEach((q, index) => {
            const card = document.createElement('div');
            card.className = 'question-card';
            card.id = `q-card-${q.id}`;

            // é–±è®€æ¸¬é©—æ–‡ç«  (å¦‚æœæ˜¯è©²é¡Œçµ„ç¬¬ä¸€é¡Œæˆ–æ˜¯éš¨æ©Ÿæ¨¡å¼ä¸‹çš„é–±è®€é¡Œ)
            if (q.passage) {
                const passage = document.createElement('div');
                passage.className = 'reading-passage';
                passage.innerText = q.passage;
                card.appendChild(passage);
            }

            // æ¨™é¡Œèˆ‡ç¨å¾Œä½œç­”
            const header = document.createElement('div');
            header.className = 'q-header';
            
            const title = document.createElement('div');
            title.className = 'q-text';
            title.innerText = `${index + 1}. ${q.q}`;
            
            const reviewLabel = document.createElement('label');
            reviewLabel.className = 'review-label';
            reviewLabel.innerHTML = `<input type="checkbox" onchange="toggleReview('${q.id}')"> ç¨å¾Œä½œç­”`;
            
            header.appendChild(title);
            header.appendChild(reviewLabel);
            card.appendChild(header);

            // é¸é …
            const optsContainer = document.createElement('div');
            optsContainer.className = 'options-container';

            let options = q.type === 'tf' ? ['O', 'X'] : q.opts;
            
            options.forEach(opt => {
                const label = document.createElement('label');
                const input = document.createElement('input');
                input.type = 'radio';
                input.name = `q-${q.id}`; // ä¿æŒåŸå§‹IDä»¥åˆ©å°æ‡‰
                input.value = opt;
                input.onchange = updateStats;
                
                label.appendChild(input);
                label.appendChild(document.createTextNode(opt));
                optsContainer.appendChild(label);
            });

            card.appendChild(optsContainer);
            quizArea.appendChild(card);
        });
    }

    function toggleReview(qid) {
        const card = document.getElementById(`q-card-${qid}`);
        const checkbox = card.querySelector('.review-label input');
        
        if (checkbox.checked) {
            card.classList.add('marked-review');
        } else {
            card.classList.remove('marked-review');
        }
        updateStats();
    }

    function updateStats() {
        let answered = 0;
        let marked = 0;
        
        currentQuestions.forEach(q => {
            const isAns = document.querySelector(`input[name="q-${q.id}"]:checked`);
            if (isAns) answered++;
            
            const isMark = document.querySelector(`#q-card-${q.id} .review-label input`).checked;
            if (isMark) marked++;
        });

        document.getElementById('count-ans').innerText = answered;
        document.getElementById('count-unans').innerText = 50 - answered;
        document.getElementById('count-mark').innerText = marked;
    }

    function updateTimer() {
        timeLeft--;
        const m = Math.floor(timeLeft / 60).toString().padStart(2, '0');
        const s = (timeLeft % 60).toString().padStart(2, '0');
        const display = document.getElementById('timer-display');
        display.innerText = `${m}:${s}`;

        // æé†’é‚è¼¯
        if (timeLeft === 15 * 60) {
            display.style.color = 'yellow';
            alert('ğŸ”” æé†’ï¼šè€ƒè©¦æ™‚é–“å‰©ä¸‹ 15 åˆ†é˜ï¼');
        }
        if (timeLeft === 8 * 60) {
            display.style.color = 'orange';
            alert('ğŸ”” æé†’ï¼šè€ƒè©¦æ™‚é–“å‰©ä¸‹ 8 åˆ†é˜ï¼è«‹åŠ å¿«é€Ÿåº¦ï¼');
        }
        if (timeLeft === 5 * 60) {
            display.style.color = 'red';
            alert('âš ï¸ è­¦å‘Šï¼šè€ƒè©¦æ™‚é–“å‰©ä¸‹ 5 åˆ†é˜ï¼è«‹æª¢æŸ¥æ˜¯å¦æœ‰æ¼ç­”ï¼');
        }

        if (timeLeft <= 0) {
            clearInterval(timer);
            alert('â° æ™‚é–“åˆ°ï¼ç³»çµ±å°‡è‡ªå‹•ç¹³å·ã€‚');
            submitQuiz(true);
        }
    }

    function preSubmitCheck() {
        let unansCount = 0;
        let markedCount = 0;
        
        currentQuestions.forEach(q => {
            if (!document.querySelector(`input[name="q-${q.id}"]:checked`)) unansCount++;
            if (document.querySelector(`#q-card-${q.id} .review-label input`).checked) markedCount++;
        });

        let msg = '';
        if (unansCount > 0) msg += `é‚„æœ‰ ${unansCount} é¡Œæœªä½œç­”ï¼\n`;
        if (markedCount > 0) msg += `é‚„æœ‰ ${markedCount} é¡Œæ¨™è¨˜ç‚ºã€Œç¨å¾Œä½œç­”ã€ï¼\n`;
        
        if (msg !== '') {
            if (confirm(`âš ï¸ ç³»çµ±æª¢æŸ¥ç™¼ç¾ï¼š\n${msg}\nç¢ºå®šè¦ç›´æ¥ç¹³å·å—ï¼Ÿ`)) {
                submitQuiz();
            }
        } else {
            if (confirm('ç¢ºå®šè¦ç¹³å·é€å‡ºå—ï¼Ÿ')) {
                submitQuiz();
            }
        }
    }

    function submitQuiz(force = false) {
        clearInterval(timer);
        window.scrollTo(0, 0);
        document.getElementById('footer-controls').classList.add('hidden');
        document.getElementById('timer-display').style.display = 'none';
        
        let score = 0;
        
        currentQuestions.forEach(q => {
            const userAnsEl = document.querySelector(`input[name="q-${q.id}"]:checked`);
            const userAns = userAnsEl ? userAnsEl.value : "æœªä½œç­”";
            const card = document.getElementById(`q-card-${q.id}`);
            
            // é–å®šé¡Œç›®
            const inputs = card.querySelectorAll('input');
            inputs.forEach(i => i.disabled = true);

            if (userAns === q.a) {
                score += 2;
                // æ­£ç¢ºä¸éœ€ç‰¹åˆ¥æ¨™ç¤ºï¼Œæˆ–è€…æ¨™ç¤ºç¶ è‰²
            } else {
                // éŒ¯èª¤è™•ç†
                card.classList.add('wrong-ans-card');
                const feedback = document.createElement('div');
                feedback.className = 'feedback-text';
                feedback.innerHTML = `âŒ æ‚¨çš„ç­”æ¡ˆï¼š<span style="text-decoration: line-through;">${userAns}</span> <span class="correct-ref">æ­£ç¢ºç­”æ¡ˆï¼š${q.a}</span>`;
                if(q.note) feedback.innerHTML += `<br><small>è§£æï¼š${q.note}</small>`;
                card.appendChild(feedback);
            }
        });

        document.getElementById('result-area').classList.remove('hidden');
        document.getElementById('final-score').innerText = `${score} åˆ†`;
    }

    // ç”¢ç”Ÿä¸¦ä¸‹è¼‰ Excel (.xls æ ¼å¼ä»¥æ”¯æ´é¡è‰²)
    function downloadExcel() {
        let tableHTML = `
            <html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns="http://www.w3.org/TR/REC-html40">
            <head>
                <meta http-equiv="content-type" content="application/vnd.ms-excel; charset=UTF-8">
            </head>
            <body>
                <table border="1">
                    <thead>
                        <tr style="background-color: #cccccc;">
                            <th>é¡Œè™Ÿ</th>
                            <th>é¡Œç›®</th>
                            <th>æ‚¨çš„ç­”æ¡ˆ</th>
                            <th>æ­£ç¢ºç­”æ¡ˆ</th>
                            <th>çµæœ</th>
                        </tr>
                    </thead>
                    <tbody>
        `;

        currentQuestions.forEach((q, index) => {
            const userAnsEl = document.querySelector(`input[name="q-${q.id}"]:checked`);
            const userAns = userAnsEl ? userAnsEl.value : "æœªä½œç­”";
            const isCorrect = userAns === q.a;
            
            // é€™è£¡è¨­å®šç´…å­—æ¨£å¼
            const rowStyle = isCorrect ? "" : "color: red; font-weight: bold;";
            const resultText = isCorrect ? "æ­£ç¢º" : "éŒ¯èª¤";

            tableHTML += `
                <tr style="${rowStyle}">
                    <td>${index + 1}</td>
                    <td>${q.q}</td>
                    <td>${userAns}</td>
                    <td>${q.a}</td>
                    <td>${resultText}</td>
                </tr>
            `;
        });

        tableHTML += `</tbody></table></body></html>`;

        const blob = new Blob([tableHTML], { type: "application/vnd.ms-excel" });
        const link = document.createElement("a");
        link.href = URL.createObjectURL(blob);
        link.download = "exam_result.xls";
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
    }

    function checkAnswersAdmin() {
        const pwd = prompt("è«‹è¼¸å…¥å¯†ç¢¼ï¼š");
        if (pwd === "1234") {
            let list = "åƒè€ƒç­”æ¡ˆï¼š\n";
            questionPool.forEach(q => {
                list += `${q.id}. ${q.a}\n`;
            });
            alert(list);
        } else {
            alert("å¯†ç¢¼éŒ¯èª¤");
        }
    }
</script>

</body>
</html>
